## Prepare data (deprecate)
mysql> create database sbtest;
### Mac
brew install sysbench
// prepare data in sbtest database
sysbench /usr/local/Cellar/sysbench/1.0.20/share/sysbench/oltp_delete.lua --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password='123456' --mysql-db=sbtest --db-driver=mysql --tables=1 --table-size=1 prepare

sysbench /usr/local/Cellar/sysbench/1.0.20/share/sysbench/oltp_delete.lua --mysql-host=127.0.0.1 --mysql-port=3306 --mysql-user=root --mysql-password='123456' --mysql-db=sbtest --db-driver=mysql --tables=3 --table-size=100 cleanup

```
mysql> show master status;
+---------------+----------+--------------+------------------+-------------------+
| File          | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+---------------+----------+--------------+------------------+-------------------+
| binlog.000004 |  5730584 |              |                  |                   |
+---------------+----------+--------------+------------------+-------------------+
```
go run main.go
```
[2020/06/22 11:14:28] [info] sync.go:235 table structure changed, clear table cache: sbtest.sbtest3
sbtest sbtest3 

OnDDL: binlog.000004 5791058
 0
 sbtest
 DROP TABLE IF EXISTS `sbtest3` /* generated by server */
  �Estd--�
          sbtest:�
 17
```

## Start mysql service
```
docker network create service --subnet 172.18.0.0/16
docker run --name mysql-master -it --rm -e "MYSQL_ROOT_PASSWORD=123456" -p 3309:3306 --net=service -v `pwd`/conf/master:/etc/mysql/conf.d/ mysql:5.7
mysql -uroot -p123456 -h127.0.0.1 -P3309
```

## Run
go run main.go --port 3309
mysql -uroot -p123456 -h127.0.0.1 -P3309 -e "drop database Test;"
mysql -uroot -p123456 -h127.0.0.1 -P3309 -e "source user.sql;"

## Result
```
[2020/09/22 20:09:08] [info] sync.go:235 table structure changed, clear table cache: Test.User
Test User 

OnDDL: mysql-bin.000003 2260
 0
 Test
 create table Test.User
(
  id int auto_increment primary key,
  name varchar(40) null,
  status enum("active","deleted") DEFAULT "active",
  created timestamp default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP
) engine=InnoDB
  �Vstd--
        Test
 12

OnPosSynced mysql-bin.000003 2260 

Test User insert [[1 Jack 1 2020-09-22 20:09:08]]

row info: id 0 1

row info: name 1 Jack

row info: status 2 1

row info: created 3 2020-09-22 20:09:08

OnPosSynced mysql-bin.000003 2533 

Test User update [[1 Jack 1 2020-09-22 20:09:08] [1 Jonh 1 2020-09-22 20:09:08]]

row info: id 0 1

row info: name 1 Jonh

row info: status 2 1

row info: created 3 2020-09-22 20:09:08

OnPosSynced mysql-bin.000003 2822 

Test User delete [[1 Jonh 1 2020-09-22 20:09:08]]

row info: id 0 1

row info: name 1 Jonh

row info: status 2 1

row info: created 3 2020-09-22 20:09:08

OnPosSynced mysql-bin.000003 3095 
```

## Reference
[利用基于canal的go库来监听binlog日志](https://blog.csdn.net/Marcus929/article/details/103871699)